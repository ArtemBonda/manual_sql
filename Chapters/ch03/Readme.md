### Глава №3. Основные работы с таблицами

Работа в интерактиыной консоли psql базы данных "db"
1. Для создания таблиц служит команда CREATE TABLE, синтаксис которой
```
CREATE TABLE "имя_таблицы" (
    имя_поля тип_данных [ограничения_целостности],
    имя_поля тип_данных [ограничения_целостности],
    ...
    имя_поля тип_данных [ограничения_целостности],
    [ограничение_целостности],
    [первичный_ключ],
    [внешний_ключ]
);
```
* получение информации о команде
```
\h CREATE TABLE
```
* проверить какую таблицу создала СУБД
```
\d [имя_таблицы]
```

* Удаление таблицы:
```
DROP TABLE имя таблицы;
```
* Ввод данных в таблицу:
```
INSERT INTO имя_таблицы [( имя_атрибута, имя_атрибута, ... )]
VALUES ( значение_атрибута, значение_атрибута, ... );
```
Обратить внимание имена атрибутов не является обязательным. Если не приведен список атрибутов, тогда обязан в предложении 
`VALUES` задавать значения с учетом того порядка, в котором они следуют в определении таблицы

* Получение выборки данных из таблицы:
```
SELECT имя_атрибута, имя_атрибута, ...
    FROM имя_таблицы;
```
```
SELECT * FROM aircrafts;
```

2. Упорядочивание значений в выборке данных
* ORDER BY - упорядочивание строк в поле
```
SELECT model, aircraft_code, range
    FROM aircrafts
    ORDER BY model;

```
* WHERE - ограничить вывод строк согласно условию:
```
SELECT model, aircraft_code, range
    FROM aircrafts
    WHERE range >= 4000 AND range <= 6000;
```
3. Обновление данных в таблице
```
UPDATE имя_таблицы
SET имя_атрибута1 = значение_атрибута1,
имя_атрибута2 = значение_атрибута2, ...
WHERE условие;
```

```
UPDATE aircrafts
    SET range = 3500
    WHERE aircraft_code = 'SU9';
```
4. Удаление строк из таблицы, используется команда `DELETE` похожая на команду `SELECT`
```
DELETE FROM имя_таблицы WHERE условие;

```
Удаление строки из таблицы
```
DELETE FROM aircrafts WHERE aircraft_code = 'CN1';
```
или удаление с ограничением:
```
DELETE FROM aircrafts WHERE range > 10000 OR range < 3000;
```
или удаление всех строк
```
DELETE FROM aircrafts;
```

С помощью специальной команды, предусмотренной в утилите psql, сохранить
всю историю выполненных вами команд в текстовом файле:
```
\s имя_файла_для_сохранения_истории_команд
```
Затем нужно открыть его в текстовом редакторе, найти в файле нужные вам команды
INSERT и, копируя команды в буфер обмена, вставить их в командную строку утилиты
psql и выполнить.

## Создание таблицы "Места"
```
CREATE TABLE seats (
    aircraft_code char( 3 ) NOT NULL,
    seat_no varchar( 4 ) NOT NULL,
    fare_conditions varchar( 10 ) NOT NULL,
    CHECK ( fare_conditions IN ( 'Economy', 'Comfort', 'Business' ) ),
    PRIMARY KEY ( aircraft_code, seat_no ),
    FOREIGN KEY ( aircraft_code )
        REFERENCES aircrafts (aircraft_code )
        ON DELETE CASCADE
);
```
* `aircraft_code`(Код самолета) и `seat_no` (Номер места) - это Составной ключ, таким образом Первичный ключ будет естественным
* Внешним ключом (FOREIGN KEY) будет aircraft_code он ссылается на аналогичный код в
таблицы `aircrafts`
* `ON DELETE CASCADE` - при удалении какой-либо строки из таблицы «Самолеты» удаление строк из таблицы «Места», связанных
с этой строкой по внешнему ключу, берет на себя СУБД, избавляя программиста от
этой заботы
 * Заполнить таблицу данными
```
INSERT INTO seats VALUES
( 'SU9', '1A', 'Business' );
```

# Функции
* `count()` - поодсчет строк в таблице
```
SELECT count( * ) FROM seats WHERE aircraft_code = 'SU9';
```
|=> это был не рациональный подход

```
SELECT aircraft_code, count(*) FROM seats GROUP BY aircraft_code;
```
|=> так происходит выборка с сортировкой по коду самолета

```
SELECT aircraft_code, count( * ) FROM seats GROUP BY aircraft_code ORDER BY count;
```
```
SELECT aircraft_code, fare_conditions, count(*) FROM seats
GROUP BY aircraft_code, fare_conditions
ORDER BY aircraft_code, fare_conditions;
```

### Контрольные вопросы (стр 35)
1. Почему произойдет ошибка
```
INSERT INTO aircrafts
VALUES ( 'SU9', 'Sukhoi SuperJet-100', 3000 );
```
2. DESC - ключевое слово,(от слова Descendant - убывающий порядок).
Напишите команду для выборки всех строк из таблицы aircrafts, чтобы строки были
упорядочены по убыванию значения атрибута «Максимальная дальность полета, км» (range).
```
SELECT * FROM aircrafts ORDER BY range DESC ;
```
3.  напишите команду UPDATE полностью, при этом не забудьте, что увеличить
дальность полета нужно только у одной модели — Sukhoi SuperJet, поэтому необходимо
использовать условие WHERE. Затем с помощью команды SELECT проверьте полученный результат.
```
UPDATE aircrafts
    SET range = range * 2
    WHERE aircraft_code = 'SU9';
```
4.Если в предложении `WHERE` команды `DELETE` вы укажете логически и синтаксически корректное условие,
но строк, удовлетворяющих этому условия, в таблице не окажется, то в ответ СУБД выведет сообщение
`DELETE 0`. Такая ситуация не является ошибкой или сбоем в работе СУБД. Например, если после удаления какой-то
строки повторно попытаться удалить ее же, то получите именно такое сообщение.
Самостоятельно смоделируйте описанную ситуацию, подобрав условие, которому гарантированно не соответствует
ни одна строка в таблице «Самолеты» (aircrafts)
```
DELETE FROM aircrafts WHERE range > 11200;
```